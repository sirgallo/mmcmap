## Tests


## Tested On

`Macbook Pro 14 with M2Pro, 16 GB Mem, 500GB SSD`


## Concurrent Test

The concurrent test fills the `mmcmap` with randomly generated byte slices, where keys and values are the same and each byte slice is 32 randomly generated letters between a-z.
```
for each test, 3 total tests are taken for write/read/delete (for multi writer/reader, lock free, lock on dynamic resize, optimistic flushing)

100,000 key val pair
  - concurrent write: 2.86, 2.66, 2.65 ~ 2.72 sec = 36,765 w/s
  - concurrent read: 0.37, 0.37, 0.34 ~ 0.36 sec = 277,778 r/s
  - concurrent delete: 2.12, 2.06, 2.40 sec ~ 2.19 = 45,662 w/s
  - file size in bytes: 262144000

1,000,000 key val pair
  - concurrent write: 40.72, 38.85, 39.35 ~ 39.64 sec = 25,227 w/s
  - concurrent read: 4.11, 4.05, 3.95 ~ 4 sec = 250,000 r/s
  - concurrent delete: 27.60, 27.84, 27.12 ~ 27.52 sec = 36,337 w/s
  - file size in bytes: 2048576000

2,000,000 key val pair
  - concurrent write: 81.29, 81.29, 82.86 ~ 81.81 sec = 24,447 w/s
  - concurrent read: 8.74, 8.42, 8.51 ~ 8.56 sec = 233,645 r/s
  - concurrent delete: 54.20, 54.21, 53.14 ~ 53.85 sec = 37,140 w/s
  - file size in bytes: 3048576000

4,000,000 key val pair
  - concurrent write: 168.51, 159.20, 159.00 ~ 162.24 sec = 24,655 w/s
  - concurrent read: 16.43, 17.01, 16.99 ~ 16.81 sec = 237,954 r/s
  - concurrent delete: 108.28, 109.04, 110.19 ~ 109.17 sec = 36,640 w/s
  - file size in bytes: 7048576000


weights for each test are as follows:

total k/v pairs: 7,100,00
100,000: 0.014
1,000,000: 0.141
2,000,000: 0.282
4,000,000: 0.563

avg write = ((0.014 * (36,765 + 45,662)) + (0.141 * (25,227 + 36,337)) + (0.282 * (24,447 + 37,140)) + (0.563 * (24,655 + 36,640)))/2
avg read = (0.014 * 277,778) + (0.141 * 250,000) + (0.282 * 233,645) + (0.563 * 237,954)

avg write: 30,855.56 w/s
avg read: 238,994.88 r/s
```


## Mixed Parallel Workload (Read/Write)

The parallel tests seeds a map with 1,000,000 randomly generated byte slices, where keys and values are the same and each byte slice is 32 randomly generated letters between a-z. 

The test involves a mixed workload of reads and writes, with 80% reads and 20% writes, where reads read the existing key-val pairs and writes create 200,000 new entries.
```
read existing: 12.66, 11.34, 11.56 ~ 11.85 sec = 67,510 r/s
write new: 10.65, 9.58, 9.27 ~ 9.83 sec = 20,346 w/s
```


## Thoughts

When mixed workload is introduced, there is a significant decrease in read performance and only a minor decrease in write performance. This can most likely be attributed to the scheduling of go routines and not favoring either reads or writes.